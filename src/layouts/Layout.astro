---
import '../styles/style.css';
import StructuredData from '../components/StructuredData.astro';
import GoogleAnalytics from '../components/GoogleAnalytics.astro';

interface Props {
  title: string;
  description?: string;
  tagline?: string;
  color?: string;
  heroImage?: string;
  isBusinessPage?: boolean;
  email?: string;
}

const {
  title,
  description,
  tagline,
  color,
  heroImage,
  isBusinessPage = false,
  email,
} = Astro.props;

const siteTitle = 'Intentional Group';
const siteDescription = 'The Intentional Group - Building Excellence in Property Development, Design & Build Interiors, Education, and Landscaping';
const pathname = Astro.url.pathname;

const metaDescription = description || (tagline ? `${tagline} - ${title} is part of The Intentional Group, Dubai UAE.` : siteDescription);
const ogImage = heroImage || 'https://intentional.ae/assets/images/intentional-logo.png';
const ogDescription = description || tagline || siteDescription;
const ogType = isBusinessPage ? 'business.business' : 'website';
const currentYear = new Date().getFullYear();
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{title} - {siteTitle}</title>

  <!-- Meta Description -->
  <meta name="description" content={metaDescription}>

  <!-- Canonical URL -->
  <link rel="canonical" href={`https://intentional.ae${pathname}`}>

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content={ogType}>
  <meta property="og:url" content={`https://intentional.ae${pathname}`}>
  <meta property="og:title" content={`${title} - ${siteTitle}`}>
  <meta property="og:description" content={ogDescription}>
  <meta property="og:image" content={ogImage}>
  <meta property="og:locale" content="en_AE">
  <meta property="og:site_name" content="The Intentional Group">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content={`${title} - ${siteTitle}`}>
  <meta name="twitter:description" content={ogDescription}>
  <meta name="twitter:image" content={ogImage}>

  <!-- Additional SEO Meta -->
  <meta name="robots" content="index, follow">
  <meta name="author" content="The Intentional Group">
  <meta name="geo.region" content="AE-DU">
  <meta name="geo.placename" content="Dubai">

  <!-- Structured Data -->
  <StructuredData
    isBusinessPage={isBusinessPage}
    title={title}
    tagline={tagline}
    email={email}
    url={pathname}
    isHome={pathname === '/'}
  />

  <!-- Google Analytics -->
  <GoogleAnalytics />
</head>
<body style={color ? `--division-color: ${color};` : undefined}>
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <header class="site-header">
    <nav class="container">
      <a href="/" class="logo">
        <img src="/assets/images/intentional-logo.png" alt="The Intentional Group" class="logo-img">
      </a>

      <!-- Mobile menu toggle -->
      <button type="button" class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>

      <ul class="nav-menu" id="nav-menu">
        <li><a href="/" class={pathname === '/' ? 'active' : ''}>Home</a></li>
        <li><a href="/businesses/intentional-development/" class={pathname.includes('intentional-development') ? 'active' : ''}>Development</a></li>
        <li><a href="/businesses/intentional-interiors/" class={pathname.includes('intentional-interiors') ? 'active' : ''}>Interiors</a></li>
        <li><a href="/businesses/intentional-education/" class={pathname.includes('intentional-education') ? 'active' : ''}>Education</a></li>
        <li><a href="/businesses/intentional-landscaping/" class={pathname.includes('intentional-landscaping') ? 'active' : ''}>Landscaping</a></li>
        <li><a href="/#contact" class={pathname.includes('contact') ? 'active' : ''}>Contact</a></li>
      </ul>
    </nav>
  </header>

  <main id={pathname !== '/' ? 'main-content' : undefined}>
    <slot />
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>The Intentional Group</h4>
          <p>Excellence in Development, Interiors, Education and Landscaping</p>
        </div>
        <div class="footer-section">
          <h4>Our Businesses</h4>
          <ul>
            <li><a href="/businesses/intentional-development/">Intentional Development</a></li>
            <li><a href="/businesses/intentional-interiors/">Intentional Interiors</a></li>
            <li><a href="/businesses/intentional-education/">Intentional Education</a></li>
            <li><a href="/businesses/intentional-landscaping/">Intentional Landscaping</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Contact</h4>
          <p>Email: <a href="mailto:info@intentional.ae">info@intentional.ae</a></p>
          <p>Phone: <a href="tel:+97143574846">+971 4 357 4846</a></p>
          <p>P.O. Box 72528 Dubai, UAE</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; {currentYear} The Intentional Group. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Mobile menu script -->
  <script is:inline>
    (function() {
      const toggle = document.querySelector('.mobile-menu-toggle');
      const menu = document.querySelector('.nav-menu');

      if (toggle && menu) {
        toggle.addEventListener('click', function() {
          const isOpen = menu.classList.toggle('is-open');
          toggle.classList.toggle('is-open');
          toggle.setAttribute('aria-expanded', isOpen);
        });

        menu.querySelectorAll('a').forEach(function(link) {
          link.addEventListener('click', function() {
            menu.classList.remove('is-open');
            toggle.classList.remove('is-open');
            toggle.setAttribute('aria-expanded', 'false');
          });
        });
      }
    })();
  </script>

  <!-- Gallery with Modal -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', function() {
      const galleries = document.querySelectorAll('.gallery-grid');

      galleries.forEach(function(gallery) {
        const items = gallery.querySelectorAll('.gallery-item');
        const perPage = 4;
        let currentPage = 0;
        const totalPages = Math.ceil(items.length / perPage);

        function showPage(page) {
          currentPage = page;
          const start = page * perPage;
          const end = start + perPage;

          items.forEach(function(item, index) {
            item.style.display = (index >= start && index < end) ? 'block' : 'none';
          });

          if (prevBtn) prevBtn.disabled = (page === 0);
          if (nextBtn) nextBtn.disabled = (page >= totalPages - 1);
          if (pageCounter) pageCounter.textContent = 'Page ' + (page + 1) + ' of ' + totalPages;
        }

        var prevBtn, nextBtn, pageCounter;
        if (items.length > perPage) {
          const paginationDiv = document.createElement('div');
          paginationDiv.className = 'gallery-pagination';

          prevBtn = document.createElement('button');
          prevBtn.type = 'button';
          prevBtn.className = 'btn btn-secondary';
          prevBtn.innerHTML = '\u2190 Previous';
          prevBtn.disabled = true;

          pageCounter = document.createElement('span');
          pageCounter.className = 'page-counter';

          nextBtn = document.createElement('button');
          nextBtn.type = 'button';
          nextBtn.className = 'btn btn-secondary';
          nextBtn.innerHTML = 'Next \u2192';

          paginationDiv.appendChild(prevBtn);
          paginationDiv.appendChild(pageCounter);
          paginationDiv.appendChild(nextBtn);
          gallery.parentNode.appendChild(paginationDiv);

          prevBtn.addEventListener('click', function() {
            if (currentPage > 0) showPage(currentPage - 1);
          });

          nextBtn.addEventListener('click', function() {
            if (currentPage < totalPages - 1) showPage(currentPage + 1);
          });
        }

        showPage(0);

        const modal = document.createElement('div');
        modal.className = 'gallery-modal';
        modal.innerHTML = '<div class="modal-content"><button type="button" class="modal-close">\u00D7 Close</button><img src="" alt=""><div class="modal-label"></div><div class="modal-nav"><button type="button" class="modal-prev">\u2190 Previous</button><span class="modal-counter"></span><button type="button" class="modal-next">Next \u2192</button></div></div>';
        document.body.appendChild(modal);

        const modalImg = modal.querySelector('img');
        const modalClose = modal.querySelector('.modal-close');
        const modalPrev = modal.querySelector('.modal-prev');
        const modalNext = modal.querySelector('.modal-next');
        const modalCounter = modal.querySelector('.modal-counter');
        const modalLabel = modal.querySelector('.modal-label');
        let currentIndex = 0;
        const allImages = Array.from(items).map(item => item.querySelector('img').src);
        const allLabels = Array.from(items).map(item => {
          const label = item.querySelector('.gallery-label');
          return label ? label.textContent : '';
        });

        function showImage(index) {
          currentIndex = index;
          modalImg.src = allImages[index];
          modalLabel.textContent = allLabels[index] || '';
          modalLabel.style.display = allLabels[index] ? 'block' : 'none';
          modalCounter.textContent = (index + 1) + ' of ' + allImages.length;
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }

        function closeModal() {
          modal.classList.remove('active');
          document.body.style.overflow = '';
        }

        items.forEach(function(item, index) {
          item.style.cursor = 'pointer';
          item.addEventListener('click', function() {
            showImage(index);
          });
        });

        modalClose.addEventListener('click', closeModal);
        modal.addEventListener('click', function(e) {
          if (e.target === modal) closeModal();
        });

        modalPrev.addEventListener('click', function(e) {
          e.stopPropagation();
          showImage((currentIndex - 1 + allImages.length) % allImages.length);
        });

        modalNext.addEventListener('click', function(e) {
          e.stopPropagation();
          showImage((currentIndex + 1) % allImages.length);
        });

        document.addEventListener('keydown', function(e) {
          if (!modal.classList.contains('active')) return;
          if (e.key === 'Escape') closeModal();
          if (e.key === 'ArrowLeft') modalPrev.click();
          if (e.key === 'ArrowRight') modalNext.click();
        });
      });
    });
  </script>
</body>
</html>
